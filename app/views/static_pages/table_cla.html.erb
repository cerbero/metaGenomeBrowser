<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<% if logged_in? %>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Typography | BlueWhale Admin</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/text.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/grid.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/layout.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="css/nav.css" media="screen" />
    <!--[if IE 6]><link rel="stylesheet" type="text/css" href="css/ie6.css" media="screen" /><![endif]-->
    <!--[if IE 7]><link rel="stylesheet" type="text/css" href="css/ie.css" media="screen" /><![endif]-->
    <link href="css/table/demo_page.css" rel="stylesheet" type="text/css" />
    <!-- BEGIN: load jquery -->
    <script src="js/jquery-1.6.4.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery-ui/jquery.ui.core.min.js"></script>
    <script src="js/jquery-ui/jquery.ui.widget.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui/jquery.ui.accordion.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui/jquery.effects.core.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui/jquery.effects.slide.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui/jquery.ui.mouse.min.js" type="text/javascript"></script>
    <script src="js/jquery-ui/jquery.ui.sortable.min.js" type="text/javascript"></script>
    <script src="js/table/jquery.dataTables.min.js" type="text/javascript"></script>
    <!-- END: load jquery -->
    <script type="text/javascript" src="js/table/table.js"></script>
    <script src="js/setup.js" type="text/javascript"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            setupLeftMenu();

            $('.datatable').dataTable();
			setSidebarHeight();


        });
    </script>
</head>
<body>
    <div class="container_12">
        <div class="grid_12 header-repeat">
            <div id="branding">
                <div class="floatleft">
                    <img src="img/logo.png" alt="Logo" /></div>
                <div class="floatright">
                    <div class="floatleft">
                        <img src="img/img-profile.jpg" alt="Profile Pic" /></div>
                    <div class="floatleft marginleft10">
                        <ul class="inline-ul floatleft">
                            <li>Hello Admin</li>
                            <li><a href="#">Config</a></li>
                <%= link_to "Log out", logout_path, method: "delete" %>
                        </ul>
                        <br />
                        <span class="small grey">Last Login: 3 hours ago</span>
                    </div>
                </div>
                <div class="clear">
                </div>
            </div>
        </div>
        <div class="clear">
        </div>
        <div class="grid_12">
            <ul class="nav main">
                <li class="ic-dashboard"><a href="dashboard"><span>Dashboard</span></a> </li>
                <li class="ic-form-style"><a href="javascript:"><span>Controls</span></a>
                    <ul>
                        <li><a href="form-controls">Forms</a> </li>
                        <li><a href="buttons">Buttons</a> </li>
                        <li><a href="form-controls">Full Page Example</a> </li>
                        <li><a href="table">Page with Sidebar Example</a> </li>
                    </ul>
                </li>
			<!--	<li class="ic-typography"><a href="typography"><span>Typography</span></a></li> -->
                <li class="ic-charts"><a href="charts"><span>Charts & Graphs</span></a></li>
                <li class="ic-grid-tables"><a href="table"><span>Data Table</span></a></li>
        <!--        
	<li class="ic-gallery dd"><a href="javascript:"><span>Image Galleries</span></a>
               		 <ul>
                        <li><a href="image-gallery">Pretty Photo</a> </li>
                        <li><a href="gallery-with-filter">Gallery with Filter</a> </li>
                    </ul>
                </li>
                <li class="ic-notifications"><a href="notifications"><span>Notifications</span></a></li>
-->
            </ul>
        </div>
        <div class="clear">
        </div>
        <div class="grid_2">
            <div class="box sidemenu">
                <div class="block" id="section-menu">
                    <ul class="section menu">
                        <li><a class="menuitem">Taxonomy</a>
                            <ul class="submenu">
                                <li><a href="table"><span>Main</span></a> </li>
                                <li><a href="table_philum"><span>Philum</span></a> </li>
                                <li><a href="table_order"><span>Order</span></a> </li>
                                <li><a href="table_class"><span>Class</span></a> </li>
                                <li><a href="table_family"><span>Family</span></a> </li>
                                <li><a href="table_genus"><span>Genus</span></a> </li>
                                <li><a href="table_species"><span>Species</span></a> </li>
                                <li><a><span></span></a> </li>
                                <li><a href="paziente"><span>Paziente</span></a> </li>
                            </ul>
                            </ul>
                        </li>
<!--
                        <li><a class="menuitem">Menu 2</a>
                            <ul class="submenu">
                                <li><a>Submenu 1</a> </li>
                                <li><a>Submenu 2</a> </li>
                                <li><a>Submenu 3</a> </li>
                                <li><a>Submenu 4</a> </li>
                                <li><a>Submenu 5</a> </li>
                            </ul>
                        </li>
                        <li><a class="menuitem">Menu 3</a>
                            <ul class="submenu">
                                <li><a>Submenu 1</a> </li>
                                <li><a>Submenu 2</a> </li>
                                <li><a>Submenu 3</a> </li>
                                <li><a>Submenu 4</a> </li>
                                <li><a>Submenu 5</a> </li>
                            </ul>
                        </li>
                        <li><a class="menuitem">Menu 4</a>
                            <ul class="submenu">
                                <li><a>Submenu 1</a> </li>
                                <li><a>Submenu 2</a> </li>
                                <li><a>Submenu 3</a> </li>
                                <li><a>Submenu 4</a> </li>
                                <li><a>Submenu 5</a> </li>
                            </ul>
                        </li>
-->
                    </ul>
                </div>
            </div>
        </div>
        <div class="grid_10">
            <div class="box round first grid">
                <h2>
                    Tables & Grids</h2>
                <div class="block">
                    
                    
                    
                    <table class="data display datatable" id="example">
					<thead>
						<tr>
							<th>Taxonomy</th>
							<th>Otu</th>
							<th>% on totals</th>
							<th>AttributeA</th>
							<th>AttributeB</th>
						</tr>
					</thead>
					<tbody>
<%
a=Neography::Rest.new.execute_query("MATCH (n:`sample5`) RETURN n")

s=Neography::Rest.new.execute_query("MATCH (n:`sample5`) WHERE has(n.`count`) RETURN sum(n.`count`)")
s=s["data"]

s=s[0][0]

o=[]
co=[]

a["data"].each do |x|

c= Neography::Node.load(x, Neography::Rest.new )
d=c.outgoing(:belongs_to).depth(6)
e=d.first(6)[4]
if o.include? (e.name) 
	g=o.index(e.name).to_i
	co[g]=co[g].to_i+c.count.to_i

else
	o << e.name
	k=c.count
	if k==nil then k=0 end
	co << k
end
end
u=[]
u<<"{
 \"name\": \"class\",
 \"children\": [
"
o.size.times{ |x| 
if x==0 then
u << "  {\"name\": \"#{o[x]}\", \"size\": #{co[x]}}"
else
u << "   ,
{\"name\": \"#{o[x]}\", \"size\": #{co[x]}}"
end}
u << " ]
}"
	File.open("/home/andrea/rails/provametagenome/public/flare.json", "w") {|f| f.write(u.join("\n"))}

o.size.times{ |x|
	%>


<tr class="gradeA">

<td><%= o[x].to_s %></td>
<td><%= co[x].to_i %></td>
<td class="center"><%= perc= (co[x].to_f/s.to_f).round(10) %></td>
<td class="center">-</td>
<td class="center">-</td>
</tr>
<% } %>
							</tbody>

				</table>
                    
          <div class="grid_15">
            <div class="box round">
 		<h2> Class</h2>
<style>

.bar {
  fill: steelblue;
}

.bar:hover {
  fill: brown;
}

.axis {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  display: none;
}

</style>
<script src="http://d3js.org/d3.v3.min.js"></script>
<div id='naroba2'>
<script>
function naroba(id){
var diameter = 960,
    format = d3.format(",d"),
    color = d3.scale.category20c();

var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(1.5);

var svg = d3.select(id).append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");

d3.json("flare.json", function(error, root) {
  var node = svg.selectAll(".node")
      .data(bubble.nodes(classes(root))
      .filter(function(d) { return !d.children; }))
    .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

  node.append("title")
      .text(function(d) { return d.className + ": " + format(d.value); });

  node.append("circle")
      .attr("r", function(d) { return d.r; })
      .style("fill", function(d) { return color(d.packageName); });

  node.append("text")
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.className.substring(0, d.r / 3); });
});

// Returns a flattened hierarchy containing all leaf nodes under the root.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size});
  }

  recurse(null, root);
  return {children: classes};
}

d3.select(self.frameElement).style("height", diameter + "px");
}
naroba('#naroba2')         

</script>
</div>
            </div>     
        </div>                  

                </div>
            </div>
        </div>
        <div class="clear">
        </div>
    </div>
    <div class="clear">
    </div>
    <div id="site_info">
        <p>
            Copyright <a href="#">BlueWhale Admin</a>. All Rights Reserved.
        </p>
    </div>


</body>  
</html>       
<% else %>
<div class="message error">
<h1> 
<%= link_to "log in", root_path %>
 non riuscito.</h1>
</div>
<% end %>
